# Installer / Controller Patches

## Installer Patches
The following changes are being applied to the installer in the installer repo -
- Change image registry path from `quay.io/ocpmetal/assisted-installer:latest`
  to `quay.io/otuchfel/assisted-installer:swarm`. Should probably make this customizable.

- Comment out destructive lines in `cleanupInstallDevice`

- Call the `swarm-installer` "binary" rather than the `coreos-installer` binary. You can see what this
  "binary" does instead - it's included in this repository.

- Disable `efibootmgr` calls - don't want to mess with the host's EFI entries.

- The reboot operation has been disabled, to avoid reboot.

- `extractIgnitionToFS`, which used the unavailable `rpm-ostree` binary, has been disabled

- Disable SSH key generation, since they will destroy the host SSH keys

- Disable daemon-reload, because it'll mess with the host

- Disable `checkLocalhostName`, because it will give the host a random hostname

- Disable `NetworkManager.service` restart, because it will mess up the host's networking

- Disable `servicesToStart` because we don't need to start any actual services

- Disable `updateSingleNodeIgnition` because it tries to parse and actual ignition file generated by
  bootkube, which we don't have, because we don't actually run bootkube.

- WIP


## Controller Patches
The following changes are being applied to the controller in the installer repo -
- Change image registry path from `quay.io/ocpmetal/assisted-installer-controller:latest`
  to `quay.io/otuchfel/assisted-installer-controller:swarm`. Should probably make this customizable.

- Replace k8s_client package with a mock, configure mock to behave like a slowly initializing
  cluster as much as we reasonably can.

- Disable `HackDNSAddressConflict` - it's too complicated to mock k8s API calls for this and the
  service couldn't care less about it, so just disable it altogether.

- WIP

